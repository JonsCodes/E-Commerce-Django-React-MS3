{"ast":null,"code":"var _jsxFileName = \"/Users/jon/Documents/Software_Dev/MS3/E-Commerce-Django-React-MS3/frontend/src/core/PaymentB.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { cartEmpty } from \"./helper/cartHelper\";\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\nimport { createOrder } from \"./helper/orderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\nimport DropIn from \"braintree-web-drop-in-react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PaymentB = ({\n  products,\n  reload = undefined,\n  setReload = f => f\n}) => {\n  _s();\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {}\n  });\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n  const getToken = (userId, token) => {\n    getmeToken(userId, token).then(info => {\n      if (info.error) {\n        setInfo({\n          ...info,\n          error: info.error\n        });\n        signout(() => {\n          return /*#__PURE__*/_jsxDEV(Redirect, {\n            to: \"/\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 35,\n            columnNumber: 20\n          }, this);\n        });\n      } else {\n        const clientToken = info.clientToken;\n        setInfo({\n          clientToken\n        });\n      }\n    });\n  };\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n  const getAmount = () => {\n    let amount = 0;\n    products.map(p => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n  const onPurchase = () => {\n    setInfo({\n      loading: true\n    });\n    let nonce;\n    let getNonce = info.instance.requestPaymentMethod().then(data => {\n      console.log(\"MYDATA\", data);\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount()\n      };\n      processPayment(userId, token, paymentData).then(response => {\n        console.log(\"POINT-1\", response);\n        if (response.error) {\n          if (response.code == \"1\") {\n            console.log(\"PAYMENT Failed!\");\n            signout(() => {\n              return /*#__PURE__*/_jsxDEV(Redirect, {\n                to: \"/\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 72,\n                columnNumber: 24\n              }, this);\n            });\n          }\n        } else {\n          setInfo({\n            ...info,\n            success: response.success,\n            loading: false\n          });\n          console.log(\"PAYMENT SUCCESS\");\n          let product_names = \"\";\n          products.forEach(function (item) {\n            product_names += item.name + \", \";\n          });\n          const orderData = {\n            products: product_names,\n            transaction_id: response.transaction.id,\n            amount: response.transaction.amount\n          };\n          createOrder(userId, token, orderData).then(response => {\n            if (response.error) {\n              if (response.code == \"1\") {\n                console.log(\"Order Failed!\");\n                signout(() => {\n                  return /*#__PURE__*/_jsxDEV(Redirect, {\n                    to: \"/\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 95,\n                    columnNumber: 30\n                  }, this);\n                });\n              }\n            } else {\n              if (response.success == true) {\n                console.log(\"ORDER PLACED!!\");\n              }\n            }\n          }).catch(error => {\n            setInfo({\n              loading: false,\n              success: false\n            });\n            console.log(\"Order FAILED\", error);\n          });\n          cartEmpty(() => {\n            console.log(\"Did we got a crash?\");\n          });\n          setReload(!reload);\n        }\n      }).catch(error => {\n        setInfo({\n          loading: false,\n          success: false\n        });\n        console.log(\"PAYMENT FAILED\", error);\n      });\n    });\n  };\n  const showbtnDropIn = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: info.clientToken !== null && products.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(DropIn, {\n          options: {\n            authorization: info.clientToken\n          },\n          onInstance: instance => info.instance = instance\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onPurchase,\n          className: \"btn btn-block btn-success\",\n          children: \"Buy Now\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Please login first or add something in cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"Your bill is $ \", getAmount()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, this), showbtnDropIn()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 149,\n    columnNumber: 5\n  }, this);\n};\n_s(PaymentB, \"K4/IVeH2LTWZoMAX5rVKHiVEHrg=\");\n_c = PaymentB;\nexport default PaymentB;\nvar _c;\n$RefreshReg$(_c, \"PaymentB\");","map":{"version":3,"names":["React","useState","useEffect","Redirect","cartEmpty","getmeToken","processPayment","createOrder","isAuthenticated","signout","DropIn","jsxDEV","_jsxDEV","PaymentB","products","reload","undefined","setReload","f","_s","info","setInfo","loading","success","clientToken","error","instance","userId","user","id","token","getToken","then","to","fileName","_jsxFileName","lineNumber","columnNumber","getAmount","amount","map","p","parseInt","price","onPurchase","nonce","getNonce","requestPaymentMethod","data","console","log","paymentData","paymentMethodNonce","response","code","product_names","forEach","item","name","orderData","transaction_id","transaction","catch","showbtnDropIn","children","length","options","authorization","onInstance","onClick","className","_c","$RefreshReg$"],"sources":["/Users/jon/Documents/Software_Dev/MS3/E-Commerce-Django-React-MS3/frontend/src/core/PaymentB.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { cartEmpty } from \"./helper/cartHelper\";\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\nimport { createOrder } from \"./helper/orderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\n\nimport DropIn from \"braintree-web-drop-in-react\";\n\nconst PaymentB = ({\n  products,\n  reload = undefined,\n  setReload = (f) => f,\n}) => {\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {},\n  });\n\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getmeToken(userId, token)\n      .then((info) => {\n        if (info.error) {\n          setInfo({\n            ...info,\n            error: info.error,\n          });\n          signout(() => {\n            return <Redirect to=\"/\" />;\n          });\n        } else {\n          const clientToken = info.clientToken;\n          setInfo({ clientToken });\n        }\n      });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n\n  const getAmount = () => {\n    let amount = 0;\n    products.map((p) => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n  const onPurchase = () => {\n    setInfo({ loading: true });\n    let nonce;\n    let getNonce = info.instance.requestPaymentMethod().then((data) => {\n      console.log(\"MYDATA\", data);\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount(),\n      };\n      processPayment(userId, token, paymentData)\n        .then((response) => {\n          console.log(\"POINT-1\", response);\n          if (response.error) {\n            if (response.code == \"1\") {\n              console.log(\"PAYMENT Failed!\");\n              signout(() => {\n                return <Redirect to=\"/\" />;\n              });\n            }\n          } else {\n            setInfo({ ...info, success: response.success, loading: false });\n            console.log(\"PAYMENT SUCCESS\");\n\n            let product_names = \"\";\n            products.forEach(function (item) {\n              product_names += item.name + \", \";\n            });\n\n            const orderData = {\n              products: product_names,\n              transaction_id: response.transaction.id,\n              amount: response.transaction.amount,\n            };\n            createOrder(userId, token, orderData)\n              .then((response) => {\n                if (response.error) {\n                  if (response.code == \"1\") {\n                    console.log(\"Order Failed!\");\n                    signout(() => {\n                      return <Redirect to=\"/\" />;\n                    });\n                  }\n                } else {\n                  if (response.success == true) {\n                    console.log(\"ORDER PLACED!!\");\n                  }\n                }\n              })\n              .catch((error) => {\n                setInfo({ loading: false, success: false });\n                console.log(\"Order FAILED\", error);\n              });\n            cartEmpty(() => {\n              console.log(\"Did we got a crash?\");\n            });\n\n            setReload(!reload);\n          }\n        })\n        .catch((error) => {\n          setInfo({ loading: false, success: false });\n          console.log(\"PAYMENT FAILED\", error);\n        });\n    });\n  };\n\n  const showbtnDropIn = () => {\n    return (\n      <div>\n        {info.clientToken !== null && products.length > 0\n          ? (\n            <div>\n              <DropIn\n                options={{ authorization: info.clientToken }}\n                onInstance={(instance) => (info.instance = instance)}\n              >\n              </DropIn>\n              <button\n                onClick={onPurchase}\n                className=\"btn btn-block btn-success\"\n              >\n                Buy Now\n              </button>\n            </div>\n          )\n          : (\n            <h3>Please login first or add something in cart</h3>\n          )}\n      </div>\n    );\n  };\n\n  return (\n    <div>\n      <h3>Your bill is $ {getAmount()}</h3>\n      {showbtnDropIn()}\n    </div>\n  );\n};\n\nexport default PaymentB;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}